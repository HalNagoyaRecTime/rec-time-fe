# 01-fe-環境変数設定手順書

## 概要
フロントエンド（React Router v7 + Vite）における環境変数の設定と管理方法について説明します。

## 実装済み環境変数一覧

### 必須環境変数
| 変数名 | デフォルト値 | 説明 | バリデーション |
|--------|------------|------|----------------|
| `VITE_API_BASE_URL` | `http://127.0.0.1:8787` | バックエンドAPIのURL | http/https形式チェック |
| `VITE_DEV_PORT` | `5173` | 開発サーバーのポート | 1-65535の範囲チェック |

### アプリ情報環境変数
| 変数名 | デフォルト値 | 説明 |
|--------|------------|------|
| `VITE_APP_VERSION` | `2025-09-12-01` | アプリケーションバージョン |
| `VITE_APP_NAME` | `RecTime PWA` | アプリケーション名 |

### オプション環境変数
| 変数名 | デフォルト値 | 説明 | 使用場面 |
|--------|------------|------|---------|
| `HTTPS_KEY_PATH` | `./localhost+1-key.pem` | HTTPS秘密鍵のパス | PWA開発・実機テスト時 |
| `HTTPS_CERT_PATH` | `./localhost+1.pem` | HTTPS証明書のパス | PWA開発・実機テスト時 |

## ファイル構成

### `.env.dev` (開発環境用)
```bash
NODE_ENV=development

# API設定
VITE_API_BASE_URL=http://127.0.0.1:8787

# 開発サーバー設定
VITE_DEV_PORT=5173
VITE_HOST=0.0.0.0

# HTTPS設定（オプション）
HTTPS_KEY_PATH=./localhost+1-key.pem
HTTPS_CERT_PATH=./localhost+1.pem

# PWA・アプリケーション設定
VITE_APP_VERSION=2025-09-12-01
VITE_APP_NAME=RecTime PWA
```

### `.env.example` (設定例)
参考にする設定例ファイル

## Gitコミット指針

### ✅ コミット対象ファイル
- `.env.example` - 設定例として**必ずコミット**

### ❌ コミット対象外ファイル
- `.env.dev` - 個人の開発環境設定（.gitignoreで除外済み）
- `.env.local` - ローカル専用設定
- `.env.staging` - ステージング環境の機密情報を含む場合

**理由:** 個人の開発環境設定や機密情報の漏洩を防ぐため

## 環境別設定

### 開発環境
- ファイル: `.env.dev`
- 使用場面: `npm run dev` 実行時
- 特徴: ローカル開発用の設定

### ステージング環境
- ファイル: `.env.staging`
- ビルドコマンド: `npm run build:staging`
- 例: `VITE_API_BASE_URL=https://stg.example.com`

### 本番環境
- クラウドプラットフォーム（Cloudflare Pages等）の管理画面で設定
- `.env`ファイルは使用しない（セキュリティ上の理由）

## バリデーション機能

### 実装箇所
`vite.config.ts` 内で環境変数のバリデーションを実装

### バリデーション内容
1. **API URL形式チェック**
   - `http://` または `https://` で始まるかチェック
   - 無効な場合はビルドエラーで停止

2. **ポート番号チェック**
   - 1-65535の範囲内かチェック
   - 文字列の場合はNaNエラー

### エラー例
```
Error: Invalid VITE_API_BASE_URL format: "invalid-url-format". Must start with http:// or https://
Error: Invalid VITE_DEV_PORT port: 99999. Must be between 1-65535
```

## 使用方法

### 1. 初回セットアップ
```bash
# 設定例をコピー
cp .env.example .env.dev

# 必要に応じて値を編集
nano .env.dev
```

### 2. 開発サーバー起動
```bash
npm run dev
# 環境変数が自動的に読み込まれる
```

### 3. バリデーションテスト
```bash
# テスト用の無効な値でテスト
npm run dev -- --mode test
# エラーが正しく表示されることを確認
```

## トラブルシューティング

### Q: 環境変数が読み込まれない
A: ファイル名が `.env.dev` になっているか確認。React Router v7では自動的に読み込まれます。

### Q: VITE_接頭辞が必要？
A: はい。Viteでは `VITE_` 接頭辞のある環境変数のみクライアントサイドで利用可能です。

### Q: 本番環境での設定方法は？
A: Cloudflareの管理画面等で同じ環境変数名を設定。`.env`ファイルは使用しません。

### Q: バリデーションエラーが出る
A: `vite.config.ts` の検証関数を確認。正しい形式で値を設定してください。

## 関連ファイル
- `vite.config.ts`: 環境変数のバリデーション実装
- `public/sw.js`: Service WorkerでのAPP_VERSION使用
- `public/manifest.webmanifest`: PWA設定でのアプリ情報使用